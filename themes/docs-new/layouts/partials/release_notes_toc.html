<aside class="sticky sidebar" data-sticky data-top-anchor="utility-bar:bottom" data-btm-anchor="footer:top">
  <div class="TableOfContents">
    <strong class="release_notes_toc">Release Versions</strong>

    <span>
      <button class="close-button hide-for-large" aria-label="Close menu" type="button" data-close>
        <span aria-hidden="true">&times;</span>
      </button>
    </span>

    {{ with $product := $.Param "release_notes" }}

      {{ $versionsUrl := ""}}
      {{ if eq $product "automate" }}
        {{ $versionsUrl = "https://packages.chef.io/releases/current/automate.json"}}
      {{ else if (eq $product "habitat") }}
        {{ $versionsUrl = "https://api.github.com/repos/habitat-sh/habitat/releases" }}
      {{ else }}
        {{ $versionsUrl = (print "https://omnitruck.chef.io/stable/" $product "/versions/all") }}
      {{ end }}

      {{ $versions := getJSON $versionsUrl }}

      {{- $versionsReversed := slice -}}
      {{ if eq $product "habitat" }}
        {{ $versionsReversed = $versions }}
      {{ else }}
        {{ $len := len $versions }}
        {{- range seq $len -}}
            {{- $versionsReversed = $versionsReversed | append (index $versions (sub $len .)) }}
        {{ end }}
      {{ end }}

      {{ $lastDate := ""}}
      {{ if eq $product "automate" }}
        <ul>
          {{ range $versionsReversed }}
            {{ $releaseYearMonth := index . "release_date" | time.Format "2006-01" }}
            {{ if ne $releaseYearMonth $lastDate }}
              <li>{{ $releaseYearMonth }}</li>
            {{ end }}
            <p><a href="#{{ .version }}">{{ .version }}</a></p>
            {{ $lastDate = $releaseYearMonth }}
          {{ end }}
        </ul>
      {{ else if eq $product "habitat" }}
        <ul>
          {{ range $version := $versionsReversed }}
            <li><a href="#{{ $version.tag_name }}">{{ $version.tag_name }}</a></li>
          {{ end }}
        </ul>

      {{ else }}
        <ul>
          {{ range $version := $versionsReversed }}
            <li><a href="#{{ $version }}">{{ $version }}</a></li>
          {{ end }}
        </ul>
      {{ end }}
    {{ end }}
  </div>
</aside>
